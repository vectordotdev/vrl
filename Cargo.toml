[package]
name = "vrl"
version = "0.1.0"
authors = ["Vector Contributors <vector@datadoghq.com>"]
edition = "2021"
publish = false

# [workspace]
# members = [
#   ".",
#   "lib/cli",
#   "lib/compiler",
#   "lib/core",
#   "lib/datadog/filter",
#   "lib/datadog/grok",
#   "lib/datadog/search-syntax",
#   "lib/diagnostic",
#   "lib/path",
#   "lib/parser",
#   "lib/proptests",
#   "lib/stdlib",
#   "lib/tests",
#   "lib/value"
# ]


[features]
default = ["compiler", "value", "diagnostic", "path", "parser", "stdlib", "datadog", "core",
# temporary
"lua", "arbitrary"
]

# Main features (on by default)
compiler = ["diagnostic", "path", "parser", "value", "dep:paste", "dep:chrono", "dep:serde", "dep:regex", "dep:bytes", "dep:ordered-float", "dep:chrono-tz", "dep:snafu", "dep:tracing",
"dep:thiserror", "dep:anymap", "dep:dyn-clone", "dep:indoc", "dep:thiserror", "dep:lalrpop-util"]
value = ["path", "dep:bytes", "dep:regex", "dep:ordered-float", "dep:chrono"]
diagnostic = ["dep:codespan-reporting", "dep:termcolor"]
path = ["dep:once_cell", "dep:serde", "dep:snafu", "dep:regex"]
parser = ["path", "diagnostic", "dep:thiserror", "dep:ordered-float", "dep:lalrpop-util"]
stdlib = ["compiler"]
core = ["json", "value", "dep:snafu", "dep:nom"]

# Datadog related features (on by default)
datadog = ["datadog_filter", "datadog_grok", "datadog_search"]
datadog_filter = ["datadog_search", "dep:regex", "dep:dyn-clone"]
datadog_grok = ["json", "value", "dep:nom", "dep:peeking_take_while", "dep:serde_json", "dep:onig", "dep:lalrpop-util", "dep:thiserror", "dep:chrono", "dep:chrono-tz", "dep:tracing"]
datadog_search = ["dep:pest", "dep:pest_derive", "dep:itertools", "dep:once_cell", "dep:regex"]

# Features that aren't used as often (default off)
cli = ["stdlib", "dep:serde_json", "dep:thiserror", "dep:clap", "dep:exitcode"]
# test_framework = ["dep:vrl-tests"]
arbitrary = ["dep:quickcheck", "dep:arbitrary"]
lua = ["dep:mlua"]
json = ["dep:serde_json", "dep:serde"]

[dependencies]

# Optional
# value = { path = "lib/value", optional = true }
# vrl-diagnostic = { path = "lib/diagnostic", optional = true }
# path = { path = "lib/path", optional = true }
# vrl-parser = { path = "lib/parser", optional = true }
# vrl-stdlib = { path = "lib/stdlib", optional = true }
# vrl-core = { path = "lib/core", optional = true }
# vrl-cli = { path = "lib/cli", optional = true }
# vrl-tests = { path = "lib/tests", optional = true }
# datadog-filter = { path = "lib/datadog/filter", optional = true }
# datadog-grok = { path = "lib/datadog/grok", optional = true }
# datadog-search-syntax = { path = "lib/datadog/search-syntax", optional = true }

anymap = { version = "1.0.0-beta.2", optional = true }
arbitrary = { version = "1", optional = true, features = ["derive"] }
bytes = { version = "1.4.0", default-features = false, optional = true }
chrono = { version = "0.4", default-features = false, features = ["clock"], optional = true }
chrono-tz = { version = "0.8.1", default-features = false, optional = true }
clap = { version = "4.1.11", features = ["derive"], optional = true }
codespan-reporting = {version = "0.11", optional = true }
dyn-clone = { version = "1.0.11", default-features = false, optional = true }
exitcode = {version = "1", optional = true }
indoc = {version = "2.0.1", optional = true }
itertools = { version = "0.10.5", default-features = false, optional = true }
lalrpop-util = { version = "0.19", optional = true }
mlua = { version = "0.8.8", default-features = false, features = ["lua54", "send", "vendored"], optional = true}
nom = { version = "7.1.3", default-features = false, features = ["std"], optional = true }
once_cell = { version = "1.17", default-features = false, features = ["std"], optional = true }
onig = { version = "6.4", default-features = false, optional = true }
ordered-float = { version = "3", default-features = false, optional = true }
paste = { version = "1", default-features = false, optional = true }
peeking_take_while = { version = "1.0.0", default-features = false, optional = true }
pest = { version = "2.5.6", default-features = false, optional = true, features = ["std"] }
pest_derive = { version = "2.5.6", default-features = false, optional = true, features = ["std"] }
regex = { version = "1", default-features = false, optional = true, features = ["std"] }
thiserror ={ version =  "1", optional = true }
serde = { version = "1", features = ["derive"], optional = true }
serde_json = { version = "1.0.94", default-features = false, optional = true, features = ["std"] }
termcolor = {version = "1", optional = true }
tracing = { version = "0.1.34", default-features = false, optional = true }
snafu = { version = "0.7", optional = true }
quickcheck = { version = "1.0.3", optional = true }

[dev-dependencies]
criterion = "0.4"
serde_json = "1"
# vrl-stdlib = { path = "lib/stdlib" }
# vrl-core = { path = "lib/core"}
indoc = "2.0.1"
tracing-test = { version = "0.2", default-features = false }
toml = { version = "0.7.3", default-features = false }

[build-dependencies]
lalrpop = { version = "0.19.8", default-features = false }

[[bench]]
name = "kind"
harness = false
