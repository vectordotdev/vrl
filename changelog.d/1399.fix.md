Function closures now correctly update type state of the program.

authors: zettroke
